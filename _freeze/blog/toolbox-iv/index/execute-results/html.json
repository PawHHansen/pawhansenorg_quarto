{
  "hash": "55ce5a3e4050eb4477882b1a6c8778d9",
  "result": {
    "markdown": "---\ntitle: \"The policy evaluator's toolbox: Presenting your next instrumental variable analysis\"\nauthor: \"Paw Hansen\"\ndate: '2023-11-03'\ncategories: [statistical analysis, policy evaluation]\nimage: featured.jpg\ndescription: 'All your econ friends are doing it. Get started with instrumental variables'\neditor_options: \n  chunk_output_type: console\ndraft: true\n---\n\n\n\n\nNew post for my [“policy evaluator’s toolbox” series](https://www.pawhansen.org/blog#category=policy%20evaluation)! Today, let's have a stab at an instrumental variable analysis. \n\nAs always, I'll go over some of the basic intuition but the main focus will be on writing some code to produce a few useful graphs and tables. For more in-depth treatment of the topic, check out the references listed below. \n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Packages used in this post\"}\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(ggsci)\nlibrary(modelsummary)\nlibrary(estimatr)\n\ntheme_set(theme_minimal(base_size = 12))\n```\n:::\n\n\n[BASIC INUTITION]\n\n### Example 1: How does smoking affect your health?\n\nFor our first example, say we wanted to know if smoking affected your health. The core problem is that whether people smoke or not is _not_ random. Rather, it is entangled in all kinds of other factors that might also affect health outcomes: education, gender, job type, and so on.\n\nIV can help us. We need some variable affecting health outcomes _only through smoking_. Ideas? Economists have naturally had their eyes fixed on taxes — a cigarette tax will affect whether people smoke or not but not their health *except through smoking status*. The idea is that we should look for provinces, states, or other units with varying cigarette taxes and then use that variation to estimate the effect of smoking on health outcomes.  \n\nTo get started, we'll simulate some data. We begin with a data frame of people and whether they smoke or not: \n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nset.seed(853)\n\nnum_observations <- 10000\n\niv_example_data <- tibble(\n  person = c(1:num_observations),\n  smoker = \n    sample(x = c(0:1), \n           size = num_observations, \n           replace = TRUE)\n  )\n```\n:::\n\n\nThen we add health outcomes:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\niv_example_data <-\n  iv_example_data |>\n  mutate(health = if_else(\n    smoker == 0,\n    rnorm(n = n(), mean = 1, sd = 1),\n    rnorm(n = n(), mean = 0, sd = 1)\n  ))\n```\n:::\n\n\nAnd finally different tax levels on smoking for each of the two provinces:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\niv_example_data <- iv_example_data |>\n  mutate(\n    province = case_when(\n      smoker == 0 ~ sample(\n        c(\"Nova Scotia\", \"Alberta\"),\n        size = n(),\n        replace = TRUE,\n        prob = c(1/2, 1/2)\n      ),\n      smoker == 1 ~ sample(\n        c(\"Nova Scotia\", \"Alberta\"),\n        size = n(),\n        replace = TRUE,\n        prob = c(1/4, 3/4)\n      )\n    ),\n    tax = case_when(province == \"Alberta\" ~ 0.3, \n                    province == \"Nova Scotia\" ~ 0.5,\n                    TRUE ~ 9999999\n                    )\n    )\n\niv_example_data \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10,000 × 5\n   person smoker  health province      tax\n    <int>  <int>   <dbl> <chr>       <dbl>\n 1      1      0  1.11   Alberta       0.3\n 2      2      1 -0.0831 Alberta       0.3\n 3      3      1 -0.0363 Alberta       0.3\n 4      4      0  2.48   Alberta       0.3\n 5      5      0  0.617  Nova Scotia   0.5\n 6      6      0  0.748  Alberta       0.3\n 7      7      0  0.499  Alberta       0.3\n 8      8      0  1.05   Nova Scotia   0.5\n 9      9      1  0.113  Alberta       0.3\n10     10      1 -0.0105 Alberta       0.3\n# ℹ 9,990 more rows\n```\n:::\n:::\n\n\nA first inspection of the data indicates that smoking does have some effect on health—healt status is lower for smokers in both provinces: \n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\niv_example_data |> \n  mutate(smoker = as.factor(smoker)) |> \n  ggplot(aes(smoker, health)) +\n  geom_jitter(aes(color = smoker), \n                  alpha = .2) + \n  facet_wrap(vars(province)) +\n  scale_color_uchicago() +\n  labs(y = \"Health status\",\n       x = \"Smoker or not\") + \n  theme(legend.position = \"bottom\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nTo estimate the effect, we can run two regressions and take their ratio: \n\n1. A regression predicting health from tax levels\n2. A regression prediction smoker status from tax levels\n3. The ratio of the two tax coefficients will then represent the effect of smoking on health status: \n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nhealth_on_tax <- lm(health ~ tax, data = iv_example_data)\nsmoker_on_tax <- lm(smoker ~ tax, data = iv_example_data)\n\ntibble(\n  coefficient = c(\"health ~ tax\", \"smoker ~ tax\", \"ratio\"),\n  value = c(\n    coef(health_on_tax)[\"tax\"],\n    coef(smoker_on_tax)[\"tax\"],\n    coef(health_on_tax)[\"tax\"] / coef(smoker_on_tax)[\"tax\"]\n  )\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 2\n  coefficient   value\n  <chr>         <dbl>\n1 health ~ tax  1.24 \n2 smoker ~ tax -1.27 \n3 ratio        -0.980\n```\n:::\n:::\n\n\nAnother way would be to use `iv_robust()` from the `estimatr` package:\n\n\n::: {#tbl-iv-model .cell tbl-cap='Instrumental variable example using simulated data'}\n\n```{.r .cell-code}\niv_robust(health ~ smoker | tax, data = iv_example_data) |>\n  modelsummary()\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\">  (1) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:center;\"> 0.977 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.041) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> smoker </td>\n   <td style=\"text-align:center;\"> −0.980 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\"> (0.081) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Num.Obs. </td>\n   <td style=\"text-align:center;\"> 10000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 </td>\n   <td style=\"text-align:center;\"> 0.201 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 Adj. </td>\n   <td style=\"text-align:center;\"> 0.201 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> AIC </td>\n   <td style=\"text-align:center;\"> 28342.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> BIC </td>\n   <td style=\"text-align:center;\"> 28363.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RMSE </td>\n   <td style=\"text-align:center;\"> 1.00 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n### Example 2: How does enrouraging someone to participate in a policy affect outcomes? \n\nFor our second example, we will look at another classic instrument: encouragement. Consider the study used in _Regression and other stories_ in which students were encouraged to watch a television show believed to improve reading abilities. The core problem is that it is not random who actually watches the show. However, we can bypass that problem by using the encouragement to watch as an instrument. \n\n\n::: {.cell}\n\n:::\n\n\n\n### Final thoughts: Presenting your next instrumental variable analysis\n\n### Cool! Where can I learn more?\n\n-   Gelman, A., Hill, J., & Vehtari, A. (2020). *Regression and other stories*. Cambridge University Press.\n- Alexander, R. (2023). *Telling Stories with Data: With Applications in R*. CRC Press.  \n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}