{
  "hash": "82b789a65729e355a80cd022c24f95bc",
  "result": {
    "markdown": "---\ntitle: \"The policy evaluator's toolbox: Synthetic Controls\"\nauthor: \"Paw Hansen\"\ndate: '2023-11-03'\ncategories: [statistical analysis, policy evaluation]\nimage: featured.jpg\ndescription: 'Synthetic controls...'\neditor_options: \n  chunk_output_type: console\ndraft: true\n---\n\n\n\n\nNew post for my [“policy evaluator’s toolbox” series](https://www.pawhansen.org/blog#category=policy%20evaluation)! \n\nCase: The economic impact of terrorism in the Basque country using data from Abadie and Gardeazabal (2003). \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(Synth)\ndata(\"basque\")\n```\n:::\n\n\n\nThe usual sequence of commands is:\n\n1. dataprep() for matrix-extraction\n2. synth() for the construction of the synthetic control group\n3. synth.tab(), gaps.plot(), and path.plot() to summarize the results\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# dataprep: prepare data for synth\ndataprep.out <-\n  dataprep(\n  foo = basque\n  ,predictors= c(\"school.illit\",\n                 \"school.prim\",\n                 \"school.med\",\n                 \"school.high\",\n                 \"school.post.high\"\n                 ,\"invest\"\n                 )\n   ,predictors.op = c(\"mean\")\n   ,dependent     = c(\"gdpcap\")\n   ,unit.variable = c(\"regionno\")\n  ,time.variable = c(\"year\")\n       ,special.predictors = list(\n        list(\"gdpcap\",1960:1969,c(\"mean\")),\n        list(\"sec.agriculture\",seq(1961,1969,2),c(\"mean\")),\n        list(\"sec.energy\",seq(1961,1969,2),c(\"mean\")),\n        list(\"sec.industry\",seq(1961,1969,2),c(\"mean\")),\n        list(\"sec.construction\",seq(1961,1969,2),c(\"mean\")),\n        list(\"sec.services.venta\",seq(1961,1969,2),c(\"mean\")),\n        list(\"sec.services.nonventa\",seq(1961,1969,2),c(\"mean\")),\n        list(\"popdens\",1969,c(\"mean\")))\n        ,treatment.identifier  = 17\n        ,controls.identifier   = c(2:16,18)\n        ,time.predictors.prior = c(1964:1969)\n,time.optimize.ssr  = c(1960:1969)\n,unit.names.variable  = c(\"regionname\")\n,time.plot = c(1955:1997)\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. combine highest and second highest\n# schooling category and eliminate highest category\n\ndataprep.out$X1[\"school.high\",] <-\n dataprep.out$X1[\"school.high\",] +\n dataprep.out$X1[\"school.post.high\",]\ndataprep.out$X1                 <-\n as.matrix(dataprep.out$X1[\n  -which(rownames(dataprep.out$X1)==\"school.post.high\"),])\ndataprep.out$X0[\"school.high\",] <-\n dataprep.out$X0[\"school.high\",] +\n dataprep.out$X0[\"school.post.high\",]\ndataprep.out$X0                 <-\ndataprep.out$X0[\n -which(rownames(dataprep.out$X0)==\"school.post.high\"),]\n# 2. make total and compute shares for the schooling catgeories\nlowest  <- which(rownames(dataprep.out$X0)==\"school.illit\")\nhighest <- which(rownames(dataprep.out$X0)==\"school.high\")\ndataprep.out$X1[lowest:highest,] <-\n (100 * dataprep.out$X1[lowest:highest,]) /\n sum(dataprep.out$X1[lowest:highest,])\ndataprep.out$X0[lowest:highest,] <-\n 100 * scale(dataprep.out$X0[lowest:highest,],\n             center=FALSE,\n             scale=colSums(dataprep.out$X0[lowest:highest,])\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# run synth\nsynth.out <- synth(data.prep.obj = dataprep.out)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nX1, X0, Z1, Z0 all come directly from dataprep object.\n\n\n**************** \n searching for synthetic control unit  \n \n\n**************** \n**************** \n**************** \n\nMSPE (LOSS V): 0.008864629 \n\nsolution.v:\n 0.01556808 0.001791073 0.04417159 0.03409436 8.45034e-05 0.2009837 0.09484593 0.007689228 0.1339499 0.008723843 0.009680725 0.1081258 0.3402913 \n\nsolution.w:\n 4.92e-08 5.17e-08 1.352e-07 2.85e-08 5.32e-08 5.177e-07 5.24e-08 7.29e-08 0.8507986 2.274e-07 4.03e-08 9.51e-08 0.1491998 5.61e-08 9.02e-08 1.061e-07 \n```\n:::\n:::\n\n\nAnd some results!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsynth_tables <- synth.tab(dataprep.res = dataprep.out,\n                          synth.res = synth.out)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsynth_tables$tab.pred\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                                        Treated Synthetic Sample Mean\nschool.illit                              3.321     7.645      10.983\nschool.prim                              85.893    82.285      80.911\nschool.med                                7.522     6.965       5.427\nschool.high                               3.264     3.105       2.679\ninvest                                   24.647    21.583      21.424\nspecial.gdpcap.1960.1969                  5.285     5.271       3.581\nspecial.sec.agriculture.1961.1969         6.844     6.179      21.353\nspecial.sec.energy.1961.1969              4.106     2.760       5.310\nspecial.sec.industry.1961.1969           45.082    37.636      22.425\nspecial.sec.construction.1961.1969        6.150     6.952       7.276\nspecial.sec.services.venta.1961.1969     33.754    41.104      36.528\nspecial.sec.services.nonventa.1961.1969   4.072     5.371       7.111\nspecial.popdens.1969                    246.890   196.288      99.414\n```\n:::\n\n```{.r .cell-code}\n# plot results:\n  # path\n  path.plot(synth.res = synth.out,\n            dataprep.res = dataprep.out,\n            Ylab = c(\"Real per-capita GDP (1986 USD, thousands)\"),\n            Xlab = c(\"year\"),\n            Ylim = c(0,13),\n            Legend = c(\"Basque country\",\"Synthetic Basque country\"),\n            )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n## gaps\n  gaps.plot(synth.res = synth.out,\n            dataprep.res = dataprep.out,\n            Ylab = c(\"Gap in real per-capita GDP (1986 USD, thousands)\"),\n            Xlab = c(\"Year\"),\n            Ylim = c(-1.5,1.5),\n            )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n\n\n### Final thoughts: Presenting your next instrumental variable analysis\n  \n\n### Cool! Where can I learn more?\n\n* Gelman, A., Hill, J., & Vehtari, A. (2020). _Regression and other stories_. Cambridge University Press.\n* ",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}