{
  "hash": "bead8ddaa83c5b958024897d918a03bf",
  "result": {
    "markdown": "---\ntitle: \"The policy evaluator's toolbox: Presenting your next regression discontinuity\n  analysis\"\nauthor: \"Paw Hansen\"\ndate: '2023-06-01'\ncategories: [statistical analysis, policy evaluation]\nimage: featured.jpg\ndescription: 'When evaluating public policies, regression discontinuity designs are impossible to live without. Here is how to do one.'\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\nIn the previous post of my [“policy evaluator’s toolbox” series](https://www.pawhansen.org/blog#category=policy%20evaluation), I showed you two basic ways of plotting results from randomized experiments. A randomized experiment should be the design you are going for whenever possible since it allows for easy estimation and clean causal inference.\n\nIn practice, though, randomized experiments may not be feasible. Often policymakers are unwilling to assign policies at random, so the question becomes what we can do in those cases if we still want to evaluate if a policy had an effect.\n\nToday, we’ll have a look at one widely-used approach: the **regression discontinuity design**. Here is the definition I got when asking ChatGPT:\n\n> “A regression discontinuity design (RDD) is a quasi-experimental research design used to estimate causal effects by taking advantage of a discontinuity in the treatment assignment process. The basic logic behind RDD is that when a certain threshold or cutoff point is used to determine whether an individual receives a treatment or not, individuals on either side of the cutoff are expected to be similar in all other relevant aspects, except for the treatment itself. By comparing the outcomes of individuals just above and just below the cutoff, researchers can attribute any differences to the treatment rather than other confounding factors.”\n\nThis is not a bad definition but I do want to emphasize one core assumptions: the assignment variable should be _continuous_ or \"smooth\" around the cutoff. \n\nIn my field of public welfare, many such cutoff variables exist:\n\n* *Age*. For example, everybody younger than 21 years old might receive free dental care\n* *Income*. For example, everybody earning above some level might lose eligibility for housing benefits\n* *Time*. For example, a new tutoring program may be implemented on January 1st making it possible to estimate its effects by comparing units just before and just after the cutoff date \n\nFinally, a popular threshold is *test scores*, which we will work with today. Specifically, we’ll use the `Chile Schools` data taken from (the highly recommendable) _Regression and Other Stories_. Let’s get our packages and load up the data:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Packages used in this post\"}\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(ggsci)\nlibrary(readr)\nlibrary(kableExtra)\n\ntheme_set(theme_minimal(base_size = 12))\n\nchile <- read_csv(\"chile.csv\")\n```\n:::\n\n\nThe `Chile Schools` data is a good example of something you will often encounter when doing policy evaluations. In 1992, the Chilean government wanted to improve poor-performing schools. To do so, the government assigned extra resources (teacher training and after-school tutoring) to all schools scoring lower than a predefined cutoff on the average fourth-grade test score. This assignment is clearly not random. In fact, we can be quite certain that the schools that received the extra resources are different from those that did not (that is why those schools received extra help!). \n\nHowever, as we move closer to the cutoff, it seems more and more likely that the schools falling on either side are not _that_ different. For example, say the cutoff was 60 points on a 100-point scale. Two schools with an average score of 30 and 70 are clearly different, and it makes no sense to compare those. But what about two schools scoring 58 and 62? Do we really believe that those schools differ fundamentally from each other? The key assumption we make in a regression discontinuity design is that the units we look at on either side of the cutoff are as-if random.\n\n### Plot 1: Showing the raw data\n\nA good place to start is to show the raw data on either side of the cutoff. In the @fig-peak, all units above the threshold (scaled to zero) received extra help, while those below did not.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Make a variable saying if schools received the treatment or not\nchile <-\n  chile %>% \n  mutate(condition = ifelse(rule2 < 0, \"Treatment\", \"Control\")) \n\n\nchile %>% \n  ggplot(aes(rule2, read92)) + \n  geom_vline(xintercept = 0, size = 1, color = \"grey50\", linetype = \"dashed\") + \n  geom_point(aes(color = condition), alpha = .6) + \n  scale_color_jama() + \n  labs(x = \"Assignment variable\",\n       y = \"Reading test score\") + \n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Reading test scores in 1992 by assignment variable. The assignment variable is centered reading test scores in 1988. Having a score less than 0 meant that schools would be included in the program.](index_files/figure-html/fig-peak-1.png){#fig-peak width=672}\n:::\n:::\n\n\nHowever, since we wanted schools to be \"alike\" (in terms of potential outcomes), we should probably focus the graph on those units that are close to the threshold. Let's define a cutoff range from -5 through 5 and make a new plot (@fig-cutoff):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchile_sub <- \n  chile %>% \n  filter(rule2 < 5, rule2 > -5) \n\nchile_sub %>% \n  ggplot(aes(rule2, read92)) + \n  geom_vline(xintercept = 0, \n             size = 1, \n             color = \"grey50\", \n             linetype = \"dashed\") + \n  geom_point(aes(color = condition)) + \n scale_color_jama() + \n  labs(x = \"Assignment variable\",\n       y = \"Reading test score\") + \n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Reading test scores in 1992 by assignment variable. In this version of the graph, only schools close to the cutoff (-5 through 5) are plotted.](index_files/figure-html/fig-cutoff-1.png){#fig-cutoff width=672}\n:::\n:::\n\n\nAnd we can even make this plot a bit clearer if we use binned averages instead of showing all data points:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchile_sub %>% \n  ggplot(aes(rule2, read92)) + \n  geom_vline(xintercept = 0, \n             size = 1, \n             color = \"grey50\", \n             linetype = \"dashed\") + \n  stat_summary_bin(aes(color = condition), \n                   fun = \"mean\", \n                   size = 2, \n                   geom = \"point\") + \n  scale_color_jama() + \n  labs(x = \"Assignment variable\",\n       y = \"Reading test score\") + \n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Reading test scores in 1992 by assignment variable. In this version of the graph, schools are plotted using binned averages on the assignment variable.](index_files/figure-html/fig-better-1.png){#fig-better width=672}\n:::\n:::\n\n\n### Plot 2: Adding the model \n\nShowing the data (to others but also yourself) is always a good place to start and a key part of of [exploratory data analysis](https://r4ds.had.co.nz/exploratory-data-analysis.html). However, to answer the question of interest (did assigning extra help to schools improve reading?), we need a model. \n\nLuckily, the modeling part of a regression discontinuity analysis is straightforward: We simply include the condition and the assignment variable as predictors in our regression model: \n\n\n::: {#tbl-effect .cell tbl-cap='Effect of being in policy program'}\n\n```{.r .cell-code}\nchile_rs <- \n  lm(read92 ~ condition + rule2, data = chile_sub) \n\nchile_rs %>% \n  tidy(conf.int=T,) %>% \n  select(-c(\"statistic\", \"std.error\", \"p.value\")) %>% \n  mutate(term = c(\"Intercept\", \"In program\", \"Assignment variable\")) %>% \n  kbl(col.names = c(\"Term\", \"Estimate\", \"Lower bound\", \"Upper bound\"),\n      digits = 2)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Term </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n   <th style=\"text-align:right;\"> Lower bound </th>\n   <th style=\"text-align:right;\"> Upper bound </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Intercept </td>\n   <td style=\"text-align:right;\"> 59.83 </td>\n   <td style=\"text-align:right;\"> 58.80 </td>\n   <td style=\"text-align:right;\"> 60.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> In program </td>\n   <td style=\"text-align:right;\"> 2.15 </td>\n   <td style=\"text-align:right;\"> 0.27 </td>\n   <td style=\"text-align:right;\"> 4.04 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Assignment variable </td>\n   <td style=\"text-align:right;\"> 0.95 </td>\n   <td style=\"text-align:right;\"> 0.61 </td>\n   <td style=\"text-align:right;\"> 1.28 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThus, the estimated effect of being in the program is about 2.15 points. \n\nTo understand this result better, and to present it in an intuitive way to stakeholders, we can plot the model on either side of the cutoff (i.e. the regression line):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nchile_sub %>% \n  ggplot(aes(rule2, read92)) + \n  geom_vline(xintercept = 0, size = 1, color = \"grey50\", linetype = \"dashed\") + \n  geom_point(aes(color = condition), alpha = .6) + \n  geom_smooth(\n    data = chile_sub %>%  filter(rule2 < 0),\n    method = \"lm\",\n    color = \"black\",\n    se = F) +\n  geom_smooth(\n    data = chile_sub %>%  filter(rule2 > 0),\n    method = \"lm\",\n    color = \"black\",\n    se = F) +\n  annotate(geom=\"text\", \n           x  = -2.5, \n           y = 33, \n           color = \"#DF8F44FF\", \n           label = \"Included in program\") + \n    annotate(geom=\"text\", \n           x  = 2.5, \n           y = 33, \n           color = \"#374E55FF\", \n           label = \"Not included in program\") + \n  scale_color_jama() + \n  labs(x = \"Assignment variable\",\n       y = \"Reading test score\") + \n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Reading test scores in 1992 by assignment variable. In this version of the graph, the fitted model on either side of the threshold is overlaid on the raw data.](index_files/figure-html/fig-final-1.png){#fig-final width=672}\n:::\n:::\n\n\n\nThe estimated effect of 2.15 points corresponds to the difference (the \"kink\") between the two lines.\n\n### Building the final model\n\nFinally, in most real-world applications, it makes sense to include pre-treatment variables that strongly predict the outcome since this can make our model estimates more precise. In our example, we have schoolchildren’s math and reading scores in 1988, which is probably useful when trying to predict reading scores in 1992. Let’s include those:\n\n\n::: {#tbl-final-model .cell tbl-cap='Effect of being in policy program, covariate adjusted'}\n\n```{.r .cell-code}\nchile_rs_final <- \n  lm(read92 ~ condition + rule2 + read88 + math88, data = chile_sub) \n\nchile_rs_final %>% \n  tidy(conf.int=T,) %>% \n  select(-c(\"statistic\", \"std.error\", \"p.value\")) %>% \n  mutate(term = c(\"Intercept\", \n                  \"In program\", \n                  \"Assignment variable\",\n                  \"Reading score in 1988\",\n                  \"Math score in 1988\")) %>% \n  kbl(col.names = c(\"Term\", \"Estimate\", \"Lower bound\", \"Upper bound\"),\n      digits = 2) \n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Term </th>\n   <th style=\"text-align:right;\"> Estimate </th>\n   <th style=\"text-align:right;\"> Lower bound </th>\n   <th style=\"text-align:right;\"> Upper bound </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Intercept </td>\n   <td style=\"text-align:right;\"> 23.35 </td>\n   <td style=\"text-align:right;\"> 14.84 </td>\n   <td style=\"text-align:right;\"> 31.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> In program </td>\n   <td style=\"text-align:right;\"> 2.08 </td>\n   <td style=\"text-align:right;\"> 0.28 </td>\n   <td style=\"text-align:right;\"> 3.88 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Assignment variable </td>\n   <td style=\"text-align:right;\"> 0.14 </td>\n   <td style=\"text-align:right;\"> -0.22 </td>\n   <td style=\"text-align:right;\"> 0.51 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Reading score in 1988 </td>\n   <td style=\"text-align:right;\"> 0.61 </td>\n   <td style=\"text-align:right;\"> 0.46 </td>\n   <td style=\"text-align:right;\"> 0.75 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Math score in 1988 </td>\n   <td style=\"text-align:right;\"> 0.16 </td>\n   <td style=\"text-align:right;\"> -0.01 </td>\n   <td style=\"text-align:right;\"> 0.32 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nAs can be seen, our confidence intervals are now slightly narrower, reflecting the extra information we have included in our analysis. \n\n### Final thoughts: plotting your next regression discontinuity analysis\nRegression discontinuity designs (RDD) are a popular way of evaluating policies when randomization b y the researcher is not an option. When doing RDD, we look for naturally occurring cutoffs that split units into a treatment and a control group. \n\nCutoff variables should be continuous. Finally, be aware that RDD is _quasi_-experimental. It is _not_ a randomized experiment, and it is on _you_ to prove that the assumptions hold.    \n\n### Cool! Where can I learn more?\n\n* Gelman, A., Hill, J., & Vehtari, A. (2020). _Regression and other stories_. Cambridge University Press.\n* Cunningham, S. (2021). _Causal inference: The mixtape_. Yale university press. \n \n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}