{
  "hash": "cfb54d8e1ac82d50e0fa38130592f3c5",
  "result": {
    "markdown": "---\ntitle: \"The policy evaluator’s toolbox: Presenting results from randomized experiments\"\nauthor: \"Paw Hansen\"\ndate: '2023-05-24'\ncategories: [statistical analysis]\nimage: featured.jpg\ndescription: 'Sensible out-of-the-box tables and plots for your next randomized controlled trial'\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\nIn this series of blog posts, I go over some of the most common experimental designs, including natural experiments such as difference-in-difference, regression discontinuity designs, and so on. \n\nThe goal is to provide you with some sensible default plots and tables you can use when writing up your next experimental analysis. For more detail on the technicalities of the individual designs, check out the sources I link to at the bottom of this post. \n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Packages used in this post\"}\n# Packages we'll be using today\nlibrary(tidyverse)\nlibrary(modelsummary)\nlibrary(marginaleffects)\nlibrary(kableExtra)\nlibrary(broom)\n\ntheme_set(theme_minimal(base_size = 12))\n```\n:::\n\n\nToday: RCTs. What better way to kick off a series on experimental designs than with a truly randomized experiment? To get started, I'll simulate some fake data we can work with. @tbl-peak shows a peak of the simulated data.  \n\n\n::: {#tbl-peak .cell tbl-cap='A peak at the simulated data'}\n\n```{.r .cell-code}\nset.seed(2707)\n\nnum_people <- 1000\ntreat_effect <- 4.5\n\ndat <- \n  tibble(\n  age = sample(18:75, num_people, replace = T), \n  female = sample(c(0, 1), num_people, replace = T), \n  non_western = sample(c(0, 1), num_people, \n                       replace = T, prob = c(.85, .15)), \n  condition = sample(0:1, size = num_people, \n                     replace = TRUE),\n  mu = 10 + .5 * age + 8 * female - 10 * non_western + \n    treat_effect * condition + .25 * (age*condition),\n  outcome = rnorm(num_people, mu, 2.5)\n) |> \n  select(-mu)\n\n# Recode into factors \ndat <- \n  dat |> \n  mutate(condition = ifelse(condition == 1, \"Treatment\", \"Control\")) |> \n  mutate(female = ifelse(female == 1, \"Female\", \"Male\")) |>\n  mutate(non_western = ifelse(non_western == 1, \"Non-western\", \"Western\"))\n\nhead(dat) |>\n  kbl(digits = 2)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:right;\"> age </th>\n   <th style=\"text-align:left;\"> female </th>\n   <th style=\"text-align:left;\"> non_western </th>\n   <th style=\"text-align:left;\"> condition </th>\n   <th style=\"text-align:right;\"> outcome </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:left;\"> Female </td>\n   <td style=\"text-align:left;\"> Western </td>\n   <td style=\"text-align:left;\"> Control </td>\n   <td style=\"text-align:right;\"> 43.60 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> Western </td>\n   <td style=\"text-align:left;\"> Control </td>\n   <td style=\"text-align:right;\"> 32.64 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:left;\"> Female </td>\n   <td style=\"text-align:left;\"> Western </td>\n   <td style=\"text-align:left;\"> Treatment </td>\n   <td style=\"text-align:right;\"> 49.03 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:left;\"> Female </td>\n   <td style=\"text-align:left;\"> Western </td>\n   <td style=\"text-align:left;\"> Control </td>\n   <td style=\"text-align:right;\"> 40.30 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:left;\"> Western </td>\n   <td style=\"text-align:left;\"> Control </td>\n   <td style=\"text-align:right;\"> 35.46 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:right;\"> 51 </td>\n   <td style=\"text-align:left;\"> Female </td>\n   <td style=\"text-align:left;\"> Western </td>\n   <td style=\"text-align:left;\"> Treatment </td>\n   <td style=\"text-align:right;\"> 60.32 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n### Presenting descriptives\n\nFirst, let's make a table to see if our two groups are balanced on average. See @tbl-balance. This would be your typical \"Table 1\" if you were writing a research paper.  \n\n\n::: {#tbl-balance .cell tbl-cap='Means of covariates across experimental conditions'}\n\n```{.r .cell-code}\ndat_summary <- \n  dat |> \n  select(\n    Age = age,\n    Female = female,\n    'Non-Western' = non_western,\n    condition,\n    -outcome,\n  )\n  \ndatasummary_balance(~condition, \n                    data = dat_summary)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"2\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"2\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Control (N=485)</div></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"2\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">Treatment (N=515)</div></th>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"2\"></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:left;\">    </th>\n   <th style=\"text-align:right;\"> Mean </th>\n   <th style=\"text-align:right;\"> Std. Dev. </th>\n   <th style=\"text-align:right;\"> Mean </th>\n   <th style=\"text-align:right;\"> Std. Dev. </th>\n   <th style=\"text-align:right;\"> Diff. in Means </th>\n   <th style=\"text-align:right;\"> Std. Error </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1.5px\"> Age </td>\n   <td style=\"text-align:left;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:right;box-shadow: 0px 1.5px\"> 46.6 </td>\n   <td style=\"text-align:right;box-shadow: 0px 1.5px\"> 16.7 </td>\n   <td style=\"text-align:right;box-shadow: 0px 1.5px\"> 47.1 </td>\n   <td style=\"text-align:right;box-shadow: 0px 1.5px\"> 16.6 </td>\n   <td style=\"text-align:right;box-shadow: 0px 1.5px\"> 0.6 </td>\n   <td style=\"text-align:right;box-shadow: 0px 1.5px\"> 1.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:right;\"> N </td>\n   <td style=\"text-align:right;\"> Pct. </td>\n   <td style=\"text-align:right;\"> N </td>\n   <td style=\"text-align:right;\"> Pct. </td>\n   <td style=\"text-align:right;\">  </td>\n   <td style=\"text-align:right;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Female </td>\n   <td style=\"text-align:left;\"> Female </td>\n   <td style=\"text-align:right;\"> 237 </td>\n   <td style=\"text-align:right;\"> 48.9 </td>\n   <td style=\"text-align:right;\"> 248 </td>\n   <td style=\"text-align:right;\"> 48.2 </td>\n   <td style=\"text-align:right;\">  </td>\n   <td style=\"text-align:right;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:right;\"> 248 </td>\n   <td style=\"text-align:right;\"> 51.1 </td>\n   <td style=\"text-align:right;\"> 267 </td>\n   <td style=\"text-align:right;\"> 51.8 </td>\n   <td style=\"text-align:right;\">  </td>\n   <td style=\"text-align:right;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Non-Western </td>\n   <td style=\"text-align:left;\"> Non-western </td>\n   <td style=\"text-align:right;\"> 72 </td>\n   <td style=\"text-align:right;\"> 14.8 </td>\n   <td style=\"text-align:right;\"> 83 </td>\n   <td style=\"text-align:right;\"> 16.1 </td>\n   <td style=\"text-align:right;\">  </td>\n   <td style=\"text-align:right;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Western </td>\n   <td style=\"text-align:right;\"> 413 </td>\n   <td style=\"text-align:right;\"> 85.2 </td>\n   <td style=\"text-align:right;\"> 432 </td>\n   <td style=\"text-align:right;\"> 83.9 </td>\n   <td style=\"text-align:right;\">  </td>\n   <td style=\"text-align:right;\">  </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nAlternatively, you could reserve that table for an appendix and instead present a table showing descriptives of the full sample. @tbl-descriptives shows an example. \n\n\n::: {#tbl-descriptives .cell tbl-cap='Means of covariates for the full sample'}\n\n```{.r .cell-code}\ndat_summary <- \n  dat |> \n  select(\n    Age = age,\n    Female = female,\n    'Non-Western' = non_western,\n    Condition = condition,\n    -outcome,\n  )\n\ndatasummary_balance(~1, \n                    data = dat_summary)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:left;\">    </th>\n   <th style=\"text-align:right;\"> Mean </th>\n   <th style=\"text-align:right;\"> Std. Dev. </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1.5px\"> Age </td>\n   <td style=\"text-align:left;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:right;box-shadow: 0px 1.5px\"> 46.9 </td>\n   <td style=\"text-align:right;box-shadow: 0px 1.5px\"> 16.6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:right;\"> N </td>\n   <td style=\"text-align:right;\"> Pct. </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Female </td>\n   <td style=\"text-align:left;\"> Female </td>\n   <td style=\"text-align:right;\"> 485 </td>\n   <td style=\"text-align:right;\"> 48.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Male </td>\n   <td style=\"text-align:right;\"> 515 </td>\n   <td style=\"text-align:right;\"> 51.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Non-Western </td>\n   <td style=\"text-align:left;\"> Non-western </td>\n   <td style=\"text-align:right;\"> 155 </td>\n   <td style=\"text-align:right;\"> 15.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Western </td>\n   <td style=\"text-align:right;\"> 845 </td>\n   <td style=\"text-align:right;\"> 84.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Condition </td>\n   <td style=\"text-align:left;\"> Control </td>\n   <td style=\"text-align:right;\"> 485 </td>\n   <td style=\"text-align:right;\"> 48.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\"> Treatment </td>\n   <td style=\"text-align:right;\"> 515 </td>\n   <td style=\"text-align:right;\"> 51.5 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n### Presenting results\n\nAfter presenting evidence that your randomization was successful, you should move on to present your results. This could be either as a regression table (@tbl-results) or as a figure (@fig-exp). \n\n\n::: {#tbl-results .cell tbl-cap='Outcome across experimental conditions (OLS estimates)'}\n\n```{.r .cell-code}\nmodel_basic <-\n  lm(outcome ~ condition, data = dat)\n\nmodel_cov_adj <-\n  lm(outcome ~ . + age*condition, data = dat)\n\nmodelsummary(models = list(\n  \"Unadjusted\" = model_basic,\n  \"Covariate adjusted\" = model_cov_adj),\n  coef_rename = c(\n    \"age\" = \"Age (in years)\",\n    \"femaleMale\" = \"Sex: Male\",\n    \"conditionTreatment\" = \"Condition: Treatment\",\n    \"non_westernWestern\" = \"Origin: Western\",\n    \"age:conditionTreatment\" = \"Age x Treatment\")\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:center;\"> Unadjusted </th>\n   <th style=\"text-align:center;\"> Covariate adjusted </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:center;\"> 35.641 </td>\n   <td style=\"text-align:center;\"> 8.141 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.553) </td>\n   <td style=\"text-align:center;\"> (0.394) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Condition: Treatment </td>\n   <td style=\"text-align:center;\"> 16.548 </td>\n   <td style=\"text-align:center;\"> 4.899 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\"> (0.770) </td>\n   <td style=\"text-align:center;\"> (0.479) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Age (in years) </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> 0.501 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> (0.007) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Sex: Male </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> −7.975 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> (0.160) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Origin: Western </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> 9.660 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> (0.221) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Age x Treatment </td>\n   <td style=\"text-align:center;\">  </td>\n   <td style=\"text-align:center;\"> 0.245 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\">  </td>\n   <td style=\"text-align:center;box-shadow: 0px 1.5px\"> (0.010) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Num.Obs. </td>\n   <td style=\"text-align:center;\"> 1000 </td>\n   <td style=\"text-align:center;\"> 1000 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 </td>\n   <td style=\"text-align:center;\"> 0.316 </td>\n   <td style=\"text-align:center;\"> 0.971 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> R2 Adj. </td>\n   <td style=\"text-align:center;\"> 0.315 </td>\n   <td style=\"text-align:center;\"> 0.971 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> AIC </td>\n   <td style=\"text-align:center;\"> 7840.9 </td>\n   <td style=\"text-align:center;\"> 4697.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> BIC </td>\n   <td style=\"text-align:center;\"> 7855.6 </td>\n   <td style=\"text-align:center;\"> 4732.1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Log.Lik. </td>\n   <td style=\"text-align:center;\"> −3917.440 </td>\n   <td style=\"text-align:center;\"> −2341.879 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> RMSE </td>\n   <td style=\"text-align:center;\"> 12.16 </td>\n   <td style=\"text-align:center;\"> 2.52 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nI personally prefer @fig-exp because in addition to showing the model (i.e. the two group averages), it also conveys information about the full distribution of data for both groups.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeans <-\n  dat %>%\n  group_by(condition) %>%\n  summarise(avg = mean(outcome),\n            sd = sd(outcome)) \n\navg_control <-\n  means %>%\n  filter(condition == \"Control\") %>%\n  select(avg)\n\ndat %>%\n  ggplot(aes(condition, outcome)) +\n  geom_jitter(aes(color = condition), alpha = .4) +\n  geom_hline(yintercept = avg_control$avg, linetype = \"dashed\", color = \"grey50\") +\n  geom_pointrange(data = means, aes(x = condition, \n                                    y = avg, \n                                    ymin = avg + sd, \n                                    ymax = avg - sd)) +\n  labs(color = \"Condition\", \n       x = NULL, \n       y = \"Outcome\") +\n  scale_color_brewer(palette = \"Set1\") +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Outcome across experimental conditions](index_files/figure-html/fig-exp-1.png){#fig-exp width=672}\n:::\n:::\n\n\n### Presenting interactions\n\nFinally, we might be interested in plotting some type of interaction with our treatment. The basic recipe is to define some values for each of the predictors and then use those to predict the outcome. We can use `augment()` from the `broom` package to do so. \n\n\n::: {.cell}\n\n```{.r .cell-code}\npred_matrix <- \n  crossing(\n    condition = c(\"Control\", \"Treatment\"),\n    age = 15:75,\n    female = \"Female\",\n    non_western = \"Western\"\n  )\n\npreds <-\n  augment(model_cov_adj, newdata = pred_matrix, se_fit = TRUE) |> \n  mutate(.lwr = .fitted - 1.96 *.se.fit,\n         .upr = .fitted + 1.96 *.se.fit)\n```\n:::\n\n\nWith our predictions, we can make a basic graph. \n\n\n::: {.cell}\n\n```{.r .cell-code}\npreds |> \n  ggplot(aes(age, .fitted, color = condition)) + \n  geom_line() +\n  geom_line(aes(y = .lwr), lty = \"dashed\", linewidth = .25) + \n  geom_line(aes(y = .upr), lty = \"dashed\", linewidth = .25) + \n  scale_color_brewer(palette = \"Set1\") + \n  geom_point(data = dat, aes(age, outcome), alpha = .1) + \n  labs(x = \"Age (in years)\",\n       y = \"Outcome\") + \n  annotate(geom = \"text\", label = \"Treated units\", x = 70, y = 65, color = \"#377eb8\") + \n  annotate(geom = \"text\", label = \"Control units\", x = 70, y = 45, color = \"#e41a1c\") + \n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Comparing treatment effects across age for treated and non-treated units](index_files/figure-html/fig-interact-1.png){#fig-interact width=672}\n:::\n:::\n\n\nNotice how this graphs the predicted outcome across age but for Western females only. Alternatively, we could average over predictions from different subgroups to calculate the _marginal effects_. The `marginaleffects` package has a nice suite of functions to help us do just that. \n\n### Final thoughts: Presenting results from randomized experiments\nRCTs are commonly used to test for causal relationships and knowing the basics in terms of presentation is therefore essential. In this post, I have shown how to use R to calculate and present some of the most common tables and figures used for RCTs. Now you're ready to present your next RCT!\n\n### Cool! Where can I learn more?\n\n* Coppock, A. (2021). Visualize as you randomize. _Advances in experimental political science_. \n\n* Healy, K. (2018). _Data visualization: a practical introduction_. Princeton University Press.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}