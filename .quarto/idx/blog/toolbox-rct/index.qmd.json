{"title":"The policy evaluator’s toolbox: Presenting results from randomized experiments","markdown":{"yaml":{"title":"The policy evaluator’s toolbox: Presenting results from randomized experiments","author":"Paw Hansen","date":"2023-05-24","categories":["statistical analysis","policy evaluation"],"image":"featured.jpg","description":"Sensible out-of-the-box tables and plots for your next randomized controlled trial","editor_options":{"chunk_output_type":"console"}},"headingText":"Packages we'll be using today","containsRefs":false,"markdown":"\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE, message = F, warning = F) \n```\n\nIn this [series of blog posts](https://www.pawhansen.org/blog#category=policy%20evaluation), I go over some of the most common experimental designs, including natural experiments such as difference-in-difference, regression discontinuity designs, and so on. \n\nThe goal is to provide you with some sensible default plots and tables you can use when writing up your next experimental analysis. For more detail on the technicalities of the individual designs, check out the sources I link to at the bottom of this post. \n\n```{r}\n#| message: false\n#| warning: false\n#| code-fold: true\n#| code-summary: \"Packages used in this post\"\n\nlibrary(tidyverse)\nlibrary(modelsummary)\nlibrary(marginaleffects)\nlibrary(kableExtra)\nlibrary(broom)\n\ntheme_set(theme_minimal(base_size = 12))\n\n```\n\nToday: RCTs. What better way to kick off a series on experimental designs than with a truly randomized experiment? To get started, I'll simulate some fake data we can work with. @tbl-peak shows a peak of the simulated data.  \n\n```{r}\n#| label: tbl-peak\n#| tbl-cap: \"A peak at the simulated data\"\n\nset.seed(2707)\n\nnum_people <- 1000\ntreat_effect <- 4.5\n\ndat <- \n  tibble(\n  age = sample(18:75, num_people, replace = T), \n  female = sample(c(0, 1), num_people, replace = T), \n  non_western = sample(c(0, 1), num_people, \n                       replace = T, prob = c(.85, .15)), \n  condition = sample(0:1, size = num_people, \n                     replace = TRUE),\n  mu = 10 + .5 * age + 8 * female - 10 * non_western + \n    treat_effect * condition + .25 * (age*condition),\n  outcome = rnorm(num_people, mu, 2.5)\n) |> \n  select(-mu)\n\n# Recode into factors \ndat <- \n  dat |> \n  mutate(condition = ifelse(condition == 1, \"Treatment\", \"Control\")) |> \n  mutate(female = ifelse(female == 1, \"Female\", \"Male\")) |>\n  mutate(non_western = ifelse(non_western == 1, \"Non-western\", \"Western\"))\n\nhead(dat) |>\n  kbl(digits = 2)\n\n```\n\n### Presenting descriptives\n\nFirst, let's make a table to see if our two groups are balanced on average. See @tbl-balance. This would be your typical \"Table 1\" if you were writing a research paper.  \n\n```{r}\n#| label: tbl-balance\n#| tbl-cap: \"Means of covariates across experimental conditions\"\n\ndat_summary <- \n  dat |> \n  select(\n    Age = age,\n    Female = female,\n    'Non-Western' = non_western,\n    condition,\n    -outcome,\n  )\n  \ndatasummary_balance(~condition, \n                    data = dat_summary)\n```\n\nAlternatively, you could reserve that table for an appendix and instead present a table showing descriptives of the full sample. @tbl-descriptives shows an example. \n\n```{r}\n#| label: tbl-descriptives\n#| tbl-cap: \"Means of covariates for the full sample\"\n\ndat_summary <- \n  dat |> \n  select(\n    Age = age,\n    Female = female,\n    'Non-Western' = non_western,\n    Condition = condition,\n    -outcome,\n  )\n\ndatasummary_balance(~1, \n                    data = dat_summary)\n  \n\n```\n\n### Presenting results\n\nAfter presenting evidence that your randomization was successful, you should move on to present your results. This could be either as a regression table (@tbl-results) or as a figure (@fig-exp). \n\n```{r}\n#| label: tbl-results\n#| tbl-cap: \"Outcome across experimental conditions (OLS estimates)\"\n\nmodel_basic <-\n  lm(outcome ~ condition, data = dat)\n\nmodel_cov_adj <-\n  lm(outcome ~ . + age*condition, data = dat)\n\nmodelsummary(models = list(\n  \"Unadjusted\" = model_basic,\n  \"Covariate adjusted\" = model_cov_adj),\n  coef_rename = c(\n    \"age\" = \"Age (in years)\",\n    \"femaleMale\" = \"Sex: Male\",\n    \"conditionTreatment\" = \"Condition: Treatment\",\n    \"non_westernWestern\" = \"Origin: Western\",\n    \"age:conditionTreatment\" = \"Age x Treatment\")\n  )\n\n```\n\nI personally prefer @fig-exp because in addition to showing the model (i.e. the two group averages), it also conveys information about the full distribution of data for both groups.  \n\n```{r}\n#| label: fig-exp\n#| fig-cap: \"Outcome across experimental conditions\"\n\nmeans <-\n  dat %>%\n  group_by(condition) %>%\n  summarise(avg = mean(outcome),\n            sd = sd(outcome)) \n\navg_control <-\n  means %>%\n  filter(condition == \"Control\") %>%\n  select(avg)\n\ndat %>%\n  ggplot(aes(condition, outcome)) +\n  geom_jitter(aes(color = condition), alpha = .4) +\n  geom_hline(yintercept = avg_control$avg, linetype = \"dashed\", color = \"grey50\") +\n  geom_pointrange(data = means, aes(x = condition, \n                                    y = avg, \n                                    ymin = avg + sd, \n                                    ymax = avg - sd)) +\n  labs(color = \"Condition\", \n       x = NULL, \n       y = \"Outcome\") +\n  scale_color_brewer(palette = \"Set1\") +\n  theme(legend.position = \"none\")\n\n```\n\n### Presenting interactions\n\nFinally, we might be interested in plotting some type of interaction with our treatment. The basic recipe is to define some values for each of the predictors and then use those to predict the outcome. We can use `augment()` from the `broom` package to do so. \n\n```{r}\n\npred_matrix <- \n  crossing(\n    condition = c(\"Control\", \"Treatment\"),\n    age = 15:75,\n    female = \"Female\",\n    non_western = \"Western\"\n  )\n\npreds <-\n  augment(model_cov_adj, newdata = pred_matrix, se_fit = TRUE) |> \n  mutate(.lwr = .fitted - 1.96 *.se.fit,\n         .upr = .fitted + 1.96 *.se.fit)\n\n```\n\nWith our predictions, we can make a basic graph as in @fig-interact. \n\n```{r}\n#| label: fig-interact\n#| fig-cap: \"Comparing treatment effects across age for treated and non-treated units\"\n\npreds |> \n  ggplot(aes(age, .fitted, color = condition)) + \n  geom_line() +\n  geom_line(aes(y = .lwr), lty = \"dashed\", linewidth = .25) + \n  geom_line(aes(y = .upr), lty = \"dashed\", linewidth = .25) + \n  scale_color_brewer(palette = \"Set1\") + \n  geom_point(data = dat, aes(age, outcome), alpha = .1) + \n  labs(x = \"Age (in years)\",\n       y = \"Outcome\") + \n  annotate(geom = \"text\", label = \"Treated units\", x = 70, y = 65, color = \"#377eb8\") + \n  annotate(geom = \"text\", label = \"Control units\", x = 70, y = 45, color = \"#e41a1c\") + \n  theme(legend.position = \"none\")\n\n```\n\nNotice how this graphs the predicted outcome across age but for Western females only. Alternatively, we could average over predictions from different subgroups to calculate the _marginal effects_. The `marginaleffects` package has a nice suite of functions to help us do just that. \n\n### Final thoughts: Presenting results from randomized experiments\n\nRCTs are commonly used to test for causal relationships and knowing the basics in terms of presentation is therefore essential. In this post, I have shown how to use R to calculate and present some of the most common tables and figures used for RCTs. Now you're ready to present your next RCT!\n\n### Cool! Where can I learn more?\n\n* Coppock, A. (2021). Visualize as you randomize. _Advances in experimental political science_. \n\n* Healy, K. (2018). _Data visualization: a practical introduction_. Princeton University Press.\n","srcMarkdownNoYaml":"\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE, message = F, warning = F) \n```\n\nIn this [series of blog posts](https://www.pawhansen.org/blog#category=policy%20evaluation), I go over some of the most common experimental designs, including natural experiments such as difference-in-difference, regression discontinuity designs, and so on. \n\nThe goal is to provide you with some sensible default plots and tables you can use when writing up your next experimental analysis. For more detail on the technicalities of the individual designs, check out the sources I link to at the bottom of this post. \n\n```{r}\n#| message: false\n#| warning: false\n#| code-fold: true\n#| code-summary: \"Packages used in this post\"\n\n# Packages we'll be using today\nlibrary(tidyverse)\nlibrary(modelsummary)\nlibrary(marginaleffects)\nlibrary(kableExtra)\nlibrary(broom)\n\ntheme_set(theme_minimal(base_size = 12))\n\n```\n\nToday: RCTs. What better way to kick off a series on experimental designs than with a truly randomized experiment? To get started, I'll simulate some fake data we can work with. @tbl-peak shows a peak of the simulated data.  \n\n```{r}\n#| label: tbl-peak\n#| tbl-cap: \"A peak at the simulated data\"\n\nset.seed(2707)\n\nnum_people <- 1000\ntreat_effect <- 4.5\n\ndat <- \n  tibble(\n  age = sample(18:75, num_people, replace = T), \n  female = sample(c(0, 1), num_people, replace = T), \n  non_western = sample(c(0, 1), num_people, \n                       replace = T, prob = c(.85, .15)), \n  condition = sample(0:1, size = num_people, \n                     replace = TRUE),\n  mu = 10 + .5 * age + 8 * female - 10 * non_western + \n    treat_effect * condition + .25 * (age*condition),\n  outcome = rnorm(num_people, mu, 2.5)\n) |> \n  select(-mu)\n\n# Recode into factors \ndat <- \n  dat |> \n  mutate(condition = ifelse(condition == 1, \"Treatment\", \"Control\")) |> \n  mutate(female = ifelse(female == 1, \"Female\", \"Male\")) |>\n  mutate(non_western = ifelse(non_western == 1, \"Non-western\", \"Western\"))\n\nhead(dat) |>\n  kbl(digits = 2)\n\n```\n\n### Presenting descriptives\n\nFirst, let's make a table to see if our two groups are balanced on average. See @tbl-balance. This would be your typical \"Table 1\" if you were writing a research paper.  \n\n```{r}\n#| label: tbl-balance\n#| tbl-cap: \"Means of covariates across experimental conditions\"\n\ndat_summary <- \n  dat |> \n  select(\n    Age = age,\n    Female = female,\n    'Non-Western' = non_western,\n    condition,\n    -outcome,\n  )\n  \ndatasummary_balance(~condition, \n                    data = dat_summary)\n```\n\nAlternatively, you could reserve that table for an appendix and instead present a table showing descriptives of the full sample. @tbl-descriptives shows an example. \n\n```{r}\n#| label: tbl-descriptives\n#| tbl-cap: \"Means of covariates for the full sample\"\n\ndat_summary <- \n  dat |> \n  select(\n    Age = age,\n    Female = female,\n    'Non-Western' = non_western,\n    Condition = condition,\n    -outcome,\n  )\n\ndatasummary_balance(~1, \n                    data = dat_summary)\n  \n\n```\n\n### Presenting results\n\nAfter presenting evidence that your randomization was successful, you should move on to present your results. This could be either as a regression table (@tbl-results) or as a figure (@fig-exp). \n\n```{r}\n#| label: tbl-results\n#| tbl-cap: \"Outcome across experimental conditions (OLS estimates)\"\n\nmodel_basic <-\n  lm(outcome ~ condition, data = dat)\n\nmodel_cov_adj <-\n  lm(outcome ~ . + age*condition, data = dat)\n\nmodelsummary(models = list(\n  \"Unadjusted\" = model_basic,\n  \"Covariate adjusted\" = model_cov_adj),\n  coef_rename = c(\n    \"age\" = \"Age (in years)\",\n    \"femaleMale\" = \"Sex: Male\",\n    \"conditionTreatment\" = \"Condition: Treatment\",\n    \"non_westernWestern\" = \"Origin: Western\",\n    \"age:conditionTreatment\" = \"Age x Treatment\")\n  )\n\n```\n\nI personally prefer @fig-exp because in addition to showing the model (i.e. the two group averages), it also conveys information about the full distribution of data for both groups.  \n\n```{r}\n#| label: fig-exp\n#| fig-cap: \"Outcome across experimental conditions\"\n\nmeans <-\n  dat %>%\n  group_by(condition) %>%\n  summarise(avg = mean(outcome),\n            sd = sd(outcome)) \n\navg_control <-\n  means %>%\n  filter(condition == \"Control\") %>%\n  select(avg)\n\ndat %>%\n  ggplot(aes(condition, outcome)) +\n  geom_jitter(aes(color = condition), alpha = .4) +\n  geom_hline(yintercept = avg_control$avg, linetype = \"dashed\", color = \"grey50\") +\n  geom_pointrange(data = means, aes(x = condition, \n                                    y = avg, \n                                    ymin = avg + sd, \n                                    ymax = avg - sd)) +\n  labs(color = \"Condition\", \n       x = NULL, \n       y = \"Outcome\") +\n  scale_color_brewer(palette = \"Set1\") +\n  theme(legend.position = \"none\")\n\n```\n\n### Presenting interactions\n\nFinally, we might be interested in plotting some type of interaction with our treatment. The basic recipe is to define some values for each of the predictors and then use those to predict the outcome. We can use `augment()` from the `broom` package to do so. \n\n```{r}\n\npred_matrix <- \n  crossing(\n    condition = c(\"Control\", \"Treatment\"),\n    age = 15:75,\n    female = \"Female\",\n    non_western = \"Western\"\n  )\n\npreds <-\n  augment(model_cov_adj, newdata = pred_matrix, se_fit = TRUE) |> \n  mutate(.lwr = .fitted - 1.96 *.se.fit,\n         .upr = .fitted + 1.96 *.se.fit)\n\n```\n\nWith our predictions, we can make a basic graph as in @fig-interact. \n\n```{r}\n#| label: fig-interact\n#| fig-cap: \"Comparing treatment effects across age for treated and non-treated units\"\n\npreds |> \n  ggplot(aes(age, .fitted, color = condition)) + \n  geom_line() +\n  geom_line(aes(y = .lwr), lty = \"dashed\", linewidth = .25) + \n  geom_line(aes(y = .upr), lty = \"dashed\", linewidth = .25) + \n  scale_color_brewer(palette = \"Set1\") + \n  geom_point(data = dat, aes(age, outcome), alpha = .1) + \n  labs(x = \"Age (in years)\",\n       y = \"Outcome\") + \n  annotate(geom = \"text\", label = \"Treated units\", x = 70, y = 65, color = \"#377eb8\") + \n  annotate(geom = \"text\", label = \"Control units\", x = 70, y = 45, color = \"#e41a1c\") + \n  theme(legend.position = \"none\")\n\n```\n\nNotice how this graphs the predicted outcome across age but for Western females only. Alternatively, we could average over predictions from different subgroups to calculate the _marginal effects_. The `marginaleffects` package has a nice suite of functions to help us do just that. \n\n### Final thoughts: Presenting results from randomized experiments\n\nRCTs are commonly used to test for causal relationships and knowing the basics in terms of presentation is therefore essential. In this post, I have shown how to use R to calculate and present some of the most common tables and figures used for RCTs. Now you're ready to present your next RCT!\n\n### Cool! Where can I learn more?\n\n* Coppock, A. (2021). Visualize as you randomize. _Advances in experimental political science_. \n\n* Healy, K. (2018). _Data visualization: a practical introduction_. Princeton University Press.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.353","theme":{"light":["litera","../../custom.css"],"dark":["slate","custom.scss"]},"smooth-scroll":true,"title-block-banner":true,"title":"The policy evaluator’s toolbox: Presenting results from randomized experiments","author":"Paw Hansen","date":"2023-05-24","categories":["statistical analysis","policy evaluation"],"image":"featured.jpg","description":"Sensible out-of-the-box tables and plots for your next randomized controlled trial","editor_options":{"chunk_output_type":"console"}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}